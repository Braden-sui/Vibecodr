name = "vibecodr-api"
main = "./src/index.ts"
compatibility_date = "2024-10-01"
compatibility_flags = ["nodejs_compat"]
 
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
head_sampling_rate = 1
persist = true

[[d1_databases]]
binding = "DB"
database_name = "vibecodr-d1"
database_id = "1d42e343-b1a3-4371-a4a3-516381599bc2"
migrations_dir = "drizzle/migrations"

[[r2_buckets]]
binding = "R2"
bucket_name = "vibecodr-assets"

[[kv_namespaces]]
binding = "RUNTIME_MANIFEST_KV"
id = "8f0dd0835dc44edd8acdbc1b96f6f394"

[assets]
# Keep assets directory local and minimal to avoid scanning unrelated paths
directory = "./assets"

[vars]
NET_PROXY_ENABLED = "true"
NET_PROXY_FREE_ENABLED = "false"
ALLOWLIST_HOSTS = "[\"vibecodr.space\",\"api.vibecodr.space\",\"vibecodr-api.braden-yig.workers.dev\",\"api.github.com\",\"raw.githubusercontent.com\"]"
CLERK_JWT_ISSUER = "https://clerk.vibecodr.space"
# Optional: comma-separated audiences (https origins or app identifiers) to require on Clerk tokens
CLERK_JWT_AUDIENCE = ""
RUNTIME_ARTIFACTS_ENABLED = "true"
CAPSULE_BUNDLE_NETWORK_MODE = "offline"
SAFETY_BLOCKED_CODE_HASHES = "[\"a01194b6e7ef74996341fcaf2578a2487fb2170a5ce4e00f8667b91a34e6209d\",\"200b5b09099113e208a663fe2810cdad71a48617e30cc4bed13894c1117243e6\"]"

# Durable Objects binding for BuildCoordinator
[durable_objects]
bindings = [
  { name = "BUILD_COORDINATOR_DURABLE", class_name = "BuildCoordinator" },
  { name = "ARTIFACT_COMPILER_DURABLE", class_name = "ArtifactCompiler" }
]

# Durable Objects migration tag
[[migrations]]
tag = "2025-11-12_build_coordinator"
new_sqlite_classes = ["BuildCoordinator"]

[[migrations]]
tag = "2025-11-14_artifact_compiler"
new_sqlite_classes = ["ArtifactCompiler"]

# Workers Analytics Engine dataset binding
[[analytics_engine_datasets]]
binding = "vibecodr_analytics_engine"
dataset = "vibecodr_analytics"

[triggers]
crons = ["45 10 * * *"]
